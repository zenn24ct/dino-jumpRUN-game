<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dinoé¢¨ã‚¸ãƒ£ãƒ³ãƒ—ãƒ©ãƒ³ â€” åœ°é¢ã«æ­£ã—ãä¹—ã‚‹ç‰ˆ</title>
<style>
:root{
  --bg:#f5f8fb;
  --world-bg: #e9f6ff;
  --ground:#efefef;
  --accent:#2b6cb0;
  --text:#111;
  --shadow: rgba(0,0,0,0.06);
  --world-width: 720px;
  --ground-h: 56px; /* åœ°é¢ã®é«˜ã• â€” JSã®å®šæ•°ã¨åˆã‚ã›ã‚‹ã“ã¨ */
}

/* åŸºæœ¬ */
*{box-sizing:border-box;margin:0;padding:0}
body{
  min-height:100vh;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP";
  background:var(--bg);
  color:var(--text);
  display:flex; align-items:center; justify-content:center;
  padding:28px;
}

/* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
.container{
  width:1000px; max-width:100%; display:flex; gap:18px; align-items:flex-start;
}

/* å·¦ï¼šã‚²ãƒ¼ãƒ  */
.game-column{ flex:1; display:flex; flex-direction:column; align-items:center; gap:8px; }

/* world: ã‚²ãƒ¼ãƒ é ˜åŸŸï¼ˆä¸­ã« ground ã‚’å…¥ã‚Œã‚‹ï¼‰ */
.world{
  width:var(--world-width);
  max-width:100%;
  height:400px;
  background:linear-gradient(180deg,#e9f6ff,#d7ecff);
  position:relative;
  border-radius:8px;
  box-shadow:0 4px 10px var(--shadow);
  overflow:visible;
}

/* ground ã‚’ world ã®å†…éƒ¨ã«é…ç½®ï¼ˆbottom:0ï¼‰ */
.ground{
  position:absolute;
  left:0; right:0; bottom:0;
  height:var(--ground-h);              /* â† ã“ã“ãŒåœ°é¢ã®é«˜ã• */
  background:var(--ground);
  border-radius:0 0 8px 8px;
  box-shadow: inset 0 1px 0 rgba(0,0,0,0.03);
  z-index:2;
}

/* runnerï¼ˆåœ°é¢ã®ä¸Šã«ç«‹ã¤ã‚ˆã† bottom ã‚’å¤‰ãˆãªã„ã§ãŠãï¼‰ */
.runner{
  position:absolute;
  left:80px;
  /* bottom ã¯ JS ã® GROUND_Y ã‚’åæ˜ ã™ã‚‹ï¼ˆåˆæœŸstyleã¯çœç•¥ã—ã¦JSã§è¨­å®šï¼‰ */
  width:56px; height:56px; border-radius:8px;
  display:flex; align-items:center; justify-content:center;
  font-weight:800; z-index:10;
}

/* éšœå®³ç‰©ã‚‚åœ°é¢ã®ä¸Šã«ç½®ãï¼ˆbottom ã‚‚ JS ã§åˆã‚ã›ã‚‹ï¼‰ */
.ob{ position:absolute; background:#333; color:#fff; border-radius:6px; display:flex; align-items:center; justify-content:center; z-index:8;}
.ob.short{ width:36px; height:36px; }
.ob.tall{ width:46px; height:64px; }

/* å³ï¼šãƒ‘ãƒãƒ« */
.panel{ width:240px; max-width:28%; background:#fff; border-radius:8px; padding:14px; box-shadow:0 4px 14px var(--shadow); display:flex; flex-direction:column; gap:12px;}
.panel h2{margin:0; font-size:18px}
.score-row{ display:flex; gap:8px; justify-content:space-between; }
.scorebox{ background:#fff; border:1px solid rgba(0,0,0,0.04); padding:8px 10px; border-radius:8px; text-align:center; font-weight:700; }

/* ãƒœã‚¿ãƒ³ãªã© */
.btn{ background:var(--accent); color:white; border:none; padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:700; }
.btn.ghost{ background:transparent; color:var(--accent); border:1px solid rgba(43,108,176,0.12); }

.dir-pad{ display:grid; grid-template-columns:repeat(3,40px); gap:8px; justify-content:center; }
.dir-pad button{ height:40px; border-radius:8px; border:1px solid rgba(0,0,0,0.06); background:#fff; cursor:pointer; font-weight:700; }

.overlay{ position:absolute; inset:0; display:none; align-items:center; justify-content:center; pointer-events:none; z-index:30; }
.game-over{ pointer-events:auto; background:white; padding:16px; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.12); text-align:center; }

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
@media (max-width:920px){
  .container{ flex-direction:column; align-items:center; gap:12px; }
  .panel{ width:92%; max-width:720px; }
  .world{ width:92%; height:44vw; }
  .ground{ height: calc(var(--ground-h) * 0.8); } /* ã‚¹ãƒãƒ›ã§å°‘ã—å°ã•ãå¯„ã›ã‚‹ */
}
</style>
</head>
<body>

<div class="container">
  <div class="game-column">
    <!-- world å†…ã« ground ã‚’ç½®ãï¼ˆé †åºã¯ä»»æ„ã ãŒ z-index ã§ç®¡ç†ï¼‰ -->
    <div class="world" id="world" aria-label="ã‚²ãƒ¼ãƒ ãƒ¯ãƒ¼ãƒ«ãƒ‰">
      <!-- ãƒ©ãƒ³ãƒŠãƒ¼ï¼ˆä½ç½®ã¯JSã§åˆæœŸåŒ–ã—ã¦bottomã‚’åˆã‚ã›ã‚‹ï¼‰ -->
      <div class="runner" id="runner">ğŸƒâ€â¡ï¸</div>

      <!-- game over overlay -->
      <div class="overlay" id="overlay">
        <div class="game-over" id="gameOverCard" style="display:none">
          <h3>Game Over</h3>
          <p id="finalScore">Score: 0</p>
          <button class="btn" id="restartBtn">Restart</button>
        </div>
      </div>

      <!-- åœ°é¢ï¼ˆworld ã®ä¸€éƒ¨ï¼‰ -->
      <div class="ground" id="ground" aria-hidden="true"></div>
    </div>

    <!-- ï¼ˆå¿…è¦ãªã‚‰åœ°é¢ã®ä¸‹ã«èª¬æ˜ãƒãƒ¼ãªã©ï¼‰ -->
    <div style="width:var(--world-width); max-width:100%; height:36px;"></div>
  </div>

  <aside class="panel" aria-label="æ“ä½œãƒ‘ãƒãƒ«">
    <h2>Dinoé¢¨ã‚¸ãƒ£ãƒ³ãƒ—ãƒ©ãƒ³</h2>
    <div class="score-row">
      <div class="scorebox">Score<br><span id="score">0</span></div>
      <div class="scorebox">Best<br><span id="best">0</span></div>
    </div>

    <div style="display:flex; gap:8px;">
      <button class="btn" id="jumpBtn">Jump â†‘</button>
      <button class="btn ghost" id="pauseBtn">Pause</button>
    </div>

    <div>
      <div style="font-size:13px;color:#666;margin-bottom:6px">æ“ä½œãƒ‘ãƒƒãƒ‰</div>
      <div class="dir-pad">
        <div></div>
        <button id="padUp">â†‘</button>
        <div></div>
        <button id="padLeft">â†</button>
        <button id="padDown">â†“</button>
        <button id="padRight">â†’</button>
      </div>
    </div>

    <div style="margin-top:auto;font-size:13px;color:#666">
      æ“ä½œï¼šã‚¹ãƒšãƒ¼ã‚¹ / â†‘ / ã‚¿ãƒƒãƒ—ã§ã‚¸ãƒ£ãƒ³ãƒ—ã€‚ãƒ‘ãƒãƒ«ã®ãƒœã‚¿ãƒ³ã§ã‚‚å¯èƒ½ã€‚
    </div>
  </aside>
</div>

<script>
/*
  å¤‰æ›´ãƒã‚¤ãƒ³ãƒˆï¼ˆJSå´ï¼‰
  - GROUND_H ã‚’ CSS å¤‰æ•°ã¨åŒã˜å€¤ï¼ˆ56ï¼‰ã«æƒãˆã‚‹
  - runner ã¨ obstacle ã® 'bottom' ã‚’ ground height ã«å›ºå®šã—ã¦ã€Œåœ°é¢ã®ä¸Šã€ã«ç½®ã
  - world å†…ã§ left ã‚’å‹•ã‹ã—ã¦éšœå®³ç‰©ã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
  - è¡çªåˆ¤å®šã¯ getBoundingClientRect()
*/

const world = document.getElementById('world');
const runnerEl = document.getElementById('runner');
const groundEl = document.getElementById('ground');
const overlay = document.getElementById('overlay');
const gameOverCard = document.getElementById('gameOverCard');
const finalScore = document.getElementById('finalScore');
const scoreEl = document.getElementById('score');
const bestEl = document.getElementById('best');

const jumpBtn = document.getElementById('jumpBtn');
const pauseBtn = document.getElementById('pauseBtn');
const restartBtn = document.getElementById('restartBtn');
const padUp = document.getElementById('padUp');
const padDown = document.getElementById('padDown');

/* --- åŒæœŸã•ã›ã‚‹å®šæ•°ï¼ˆCSSå¤‰æ•° --ground-h ã¨ä¸€è‡´ã•ã›ã‚‹ï¼‰ --- */
const GROUND_H = 56;     // px â€” *å¿…ãš* CSSã® --ground-h ã¨åˆã‚ã›ã¦ãã ã•ã„
const RUNNER_W = 56;
const RUNNER_H = 56;

/* çŠ¶æ…‹ */
let score = 0;
let best = Number(localStorage.getItem('runner_best') || 0);
bestEl.textContent = best;

let lastTime = null;
let running = true;
let gameOver = false;

const GRAVITY = 1400;
const JUMP_V = 540;

let ry = GROUND_H; // runner ã® bottom ã‚’åœ°é¢é«˜ã«åˆã‚ã›ã‚‹ï¼ˆåˆæœŸï¼šç«‹ã£ã¦ã„ã‚‹çŠ¶æ…‹ï¼‰
let vy = 0;

let obstacles = []; // {el, x, w, h}
let spawnTimer = 0;
let spawnInterval = 1200;
let speed = 260;
let scoreAcc = 0;

/* ----- åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼šãƒ©ãƒ³ãƒŠãƒ¼ï¼†ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã®ä½ç½®ã‚’åˆã‚ã›ã‚‹ ----- */
function initPositions(){
  // ãƒ©ãƒ³ãƒŠãƒ¼ã‚’åœ°é¢ã®ä¸Šã«ç½®ãï¼ˆbottom ã®åˆæœŸå€¤ï¼‰
  runnerEl.style.bottom = GROUND_H + 'px';
  // éšœå®³ç‰©ã‚’ä½œã‚‹ã¨ãã‚‚ bottom ã‚’ GROUND_H ã«æƒãˆã‚‹ï¼ˆspawnObstacleã§è¨­å®šï¼‰
}
initPositions();

/* éšœå®³ç‰©ç”Ÿæˆ */
function spawnObstacle(){
  const isTall = Math.random() < 0.45;
  const el = document.createElement('div');
  el.className = 'ob ' + (isTall ? 'tall' : 'short');
  // world ã«è¿½åŠ ã—ã¦ã‹ã‚‰å·¦ä½ç½®ã‚’æ±ºã‚ã‚‹
  world.appendChild(el);
  const worldRect = world.getBoundingClientRect();
  const startX = worldRect.width + 20;
  el.style.left = startX + 'px';
  // éšœå®³ç‰©ã® bottom ã‚’åœ°é¢é«˜ã•ã«æƒãˆã‚‹ï¼ˆCSS bottomï¼‰
  el.style.bottom = GROUND_H + 'px';
  const w = isTall ? 46 : 36;
  const h = isTall ? 64 : 36;
  obstacles.push({el, x: startX, w, h});
}

/* è¡çªåˆ¤å®šï¼ˆviewportåº§æ¨™ã§æ­£ç¢ºã«ï¼‰ */
function checkCollision(){
  const rRect = runnerEl.getBoundingClientRect();
  for(const o of obstacles){
    const oRect = o.el.getBoundingClientRect();
    if(rRect.left < oRect.right && rRect.right > oRect.left && rRect.top < oRect.bottom && rRect.bottom > oRect.top){
      return true;
    }
  }
  return false;
}

/* æ›´æ–°ï¼ˆdt ç§’ï¼‰ */
function update(dt){
  if(!running || gameOver) return;

  // ç‰©ç†ï¼ˆvy ã¯ä¸Šå‘ãæ­£ï¼‰
  vy -= GRAVITY * dt;
  ry += vy * dt;
  // ç€åœ°åˆ¤å®š â€” ry ãŒ GROUND_H ã‚ˆã‚Šä½ããªã‚‰åœ°é¢ã«æˆ»ã™
  if(ry <= GROUND_H){
    ry = GROUND_H;
    vy = 0;
  }
  // ãƒ©ãƒ³ãƒŠãƒ¼ã® translateY ã‚’æ›´æ–°ï¼ˆè² ã®å€¤ã§ä¸Šæ–¹å‘ï¼‰
  runnerEl.style.transform = `translateY(${- (ry - GROUND_H) }px)`;
  // (è§£èª¬) runnerEl.style.bottom ã¯å›ºå®šã—ã¦ã‚ã‚‹ã®ã§ transform ã§å‚ç›´ç§»å‹•ã‚’è¡¨ç¾ã€‚
  // transform ã‚’ä½¿ã†ã¨æç”»ãŒæ»‘ã‚‰ã‹ã§é«˜é€Ÿã€‚

  // éšœå®³ç‰©ç§»å‹•ï¼ˆleft ã‚’ç›´æ¥æ›´æ–°ï¼‰
  for(let i = obstacles.length - 1; i >= 0; i--){
    const o = obstacles[i];
    o.x -= speed * dt;
    o.el.style.left = o.x + 'px';
    // ç”»é¢å¤–ã§å‰Šé™¤
    if(o.x + o.w < -80){
      o.el.remove();
      obstacles.splice(i,1);
    }
  }

  // ã‚¹ãƒãƒ¼ãƒ³ç®¡ç†
  spawnTimer += dt * 1000;
  if(spawnTimer > spawnInterval){
    spawnTimer = 0;
    spawnObstacle();
    spawnInterval = Math.max(520, 900 + (Math.random()*400 - 200));
  }

  // ã‚¹ã‚³ã‚¢ï¼ˆæ™‚é–“ãƒ™ãƒ¼ã‚¹ï¼‰
  scoreAcc += dt * 100;
  if(scoreAcc >= 1){
    score += Math.floor(scoreAcc);
    scoreAcc -= Math.floor(scoreAcc);
    scoreEl.textContent = score;
  }

  // è¡çªåˆ¤å®š
  if(checkCollision()){
    endGame();
  }
}

/* ãƒ«ãƒ¼ãƒ— */
function loop(ts){
  if(!lastTime) lastTime = ts;
  const dt = (ts - lastTime) / 1000;
  lastTime = ts;
  update(dt);
  if(!gameOver) requestAnimationFrame(loop);
}

/* å…¥åŠ›/ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ */
function jump(){
  if(gameOver) return;
  // on ground?
  const onGround = Math.abs(ry - GROUND_H) < 0.5;
  if(onGround){
    vy = JUMP_V;
  }
}
function togglePause(){
  running = !running;
  pauseBtn.textContent = running ? 'Pause' : 'Resume';
}
function endGame(){
  gameOver = true;
  running = false;
  overlay.style.display = 'flex';
  gameOverCard.style.display = 'block';
  finalScore.textContent = 'Score: ' + score;
  if(score > best){
    best = score;
    localStorage.setItem('runner_best', best);
    bestEl.textContent = best;
  }
}
function restart(){
  // clear obstacles
  obstacles.forEach(o => o.el.remove());
  obstacles = [];
  // reset variables
  spawnTimer = 0;
  spawnInterval = 1200;
  speed = 260;
  score = 0;
  scoreAcc = 0;
  vy = 0;
  ry = GROUND_H;
  lastTime = null;
  running = true;
  gameOver = false;
  overlay.style.display = 'none';
  gameOverCard.style.display = 'none';
  scoreEl.textContent = 0;
  requestAnimationFrame(loop);
}

/* ã‚¤ãƒ™ãƒ³ãƒˆ */
window.addEventListener('keydown', e => {
  if([' ', 'ArrowUp', 'w', 'W'].includes(e.key)) { jump(); e.preventDefault(); }
  if(e.key === 'p' || e.key === 'P') togglePause();
});
world.addEventListener('pointerdown', () => jump());
jumpBtn.addEventListener('click', jump);
padUp.addEventListener('click', jump);
restartBtn.addEventListener('click', restart);
pauseBtn.addEventListener('click', togglePause);
padDown.addEventListener('click', ()=>{/* placeholder for duck */});

/* start */
requestAnimationFrame(loop);
</script>
</body>
</html>
